# 消息提醒

要使用此文档所示的接口，请先[登录](./登录.md)。

你应该注意到了，在几乎所有接口的返回数据里，有个`user`字段：

```json
{
    "code": 0,
    "message": "success",
    "data": null,
    "user": {
        "uid": 287813,
        "username": "Range6",
        "new_pm_legacy": false,
        "new_notification": 0,
        "new_pm": 0,
        "new_grouppm_legacy": false,
        "settings_version": 0
    },
    "system": {
        "settings_version": 11,
        "client_version": 1
    }
}
```

里面的`new_pm_legacy`、`new_notification`、`new_pm`、`new_grouppm_legacy`即表示新消息数量。因此你不需要主动通过本页的接口来获取新消息提醒，在调用其他接口时就能顺带完成，只要当要获取详细信息时，才使用本文档接口。

## 获取新消息提醒摘要

<details>
    <summary>数据包</summary>

```text
GET /_/messages/summary HTTP/1.1
Host: bbs.uestc.edu.cn
Cookie: 有效Cookie
Authorization: 有效Authorization
```

</details>
<br>

方法：`GET`

路径：`/_/messages/summary`

### 响应

下面的json展示了大部分常见种类的消息提醒对应的格式供参考。

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "new_messages": {
            "chat": 2,
            "posts": {
                "reply": 1,
                "comment": 1,
                "at": 1,
                "rate": 1,
                "other": 0
            },
            "system": {
                "friend": 1,
                "space": 0,
                "task": 0,
                "report": 0,
                "system": 1,
                "admin": 0,
                "app": 0
            }
        },
        "new_notifications": [{
            "id": 5536282,
            "user_id": 296528,
            "type": "system",
            "unread": true,
            "author_id": 287813,
            "author": "Range6",
            "html_message": "恭喜您的主题 \u003ca href=\"forum.php?mod=viewthread\u0026tid=2413370\"\u003ewater\u003c/a\u003e 被 \u003ca href=\"home.php?mod=space\u0026uid=287813\" target=\"_blank\"\u003eRange6\u003c/a\u003e 收录至公共收藏夹（淘专辑）\u003ca href=\"forum.php?mod=collection\u0026action=view\u0026ctid=1130\"\u003etest\u003c/a\u003e！",
            "dateline": 1765420665,
            "from_id": 1130,
            "from_id_type": "collectionthread",
            "from_num": 1,
            "category": 3,
            "kind": "thread_collect",
            "subject": "water",
            "thread_id": 2413370,
            "collection_id": 1130,
            "collection_name": "test"
        }, {
            "id": 5536280,
            "user_id": 296528,
            "type": "system",
            "unread": true,
            "author_id": 287813,
            "author": "Range6",
            "html_message": "您在主题 \u003ca href=\"forum.php?mod=redirect\u0026goto=findpost\u0026pid=41378853\u0026ptid=2413370\" target=\"_blank\"\u003ewater\u003c/a\u003e 的帖子被 \u003ca href=\"home.php?mod=space\u0026uid=287813\"\u003eRange6\u003c/a\u003e 评分 水滴 +1 滴 \u003cdiv class=\"quote\"\u003e\u003cblockquote\u003e评分信息\u003c/blockquote\u003e\u003c/div\u003e",
            "dateline": 1765420648,
            "from_id": 0,
            "from_id_type": "rate",
            "from_num": 1,
            "category": 3,
            "kind": "rate",
            "subject": "water",
            "thread_id": 41378853,
            "post_id": 2413370,
            "credits": {
                "水滴": 1
            },
            "reason": "评分信息",
            "Moderate": false
        }, {
            "id": 5536278,
            "user_id": 296528,
            "type": "pcomment",
            "unread": true,
            "author_id": 287813,
            "author": "Range6",
            "html_message": "Range6 点评了您曾经在主题 \u003ca href=\"forum.php?mod=viewthread\u0026tid=2413370\" target=\"_blank\"\u003ewater\u003c/a\u003e 发表的帖子 \u0026nbsp; \u003ca href=\"forum.php?mod=redirect\u0026goto=findpost\u0026pid=41378853\u0026ptid=2413370\" target=\"_blank\" class=\"lit\"\u003e查看 \u0026rsaquo;\u003c/a\u003e",
            "dateline": 1765420638,
            "from_id": 2413370,
            "from_id_type": "pcomment",
            "from_num": 1,
            "category": 1,
            "kind": "comment",
            "subject": "water",
            "thread_id": 2413370,
            "post_id": 41378853
        }, {
            "id": 5536274,
            "user_id": 296528,
            "type": "post",
            "unread": true,
            "author_id": 287813,
            "author": "Range6",
            "html_message": "Range6 回复了您的帖子 \u003ca href=\"forum.php?mod=redirect\u0026goto=findpost\u0026ptid=2413370\u0026pid=41378858\" target=\"_blank\"\u003ewater\u003c/a\u003e \u0026nbsp; \u003ca href=\"forum.php?mod=redirect\u0026goto=findpost\u0026pid=41378858\u0026ptid=2413370\" target=\"_blank\" class=\"lit\"\u003e查看\u003c/a\u003e",
            "dateline": 1765420597,
            "from_id": 2413370,
            "from_id_type": "post",
            "from_num": 1,
            "category": 1,
            "kind": "reply",
            "subject": "water",
            "thread_id": 2413370,
            "post_id": 41378858
        }, {
            "id": 5536204,
            "user_id": 296528,
            "type": "at",
            "unread": true,
            "author_id": 287813,
            "author": "Range6",
            "html_message": "\u003ca href=\"home.php?mod=space\u0026uid=287813\" target=\"_blank\"\u003eRange6\u003c/a\u003e 在主题 \u003ca href=\"forum.php?mod=redirect\u0026goto=findpost\u0026ptid=2413359\u0026pid=41378574\" target=\"_blank\"\u003e开畔+四级散水\u003c/a\u003e 中提到了您\u003cdiv class=\"quote\"\u003e\u003cblockquote\u003e@AOSP 提到\u003c/blockquote\u003e\u003c/div\u003e\u003ca href=\"forum.php?mod=redirect\u0026goto=findpost\u0026ptid=2413359\u0026pid=41378574\" target=\"_blank\"\u003e现在去看看\u003c/a\u003e。",
            "dateline": 1765419583,
            "from_id": 2413359,
            "from_id_type": "at",
            "from_num": 1,
            "category": 1,
            "kind": "at",
            "subject": "开畔+四级散水",
            "thread_id": 2413359,
            "post_id": 41378574,
            "summary": "@AOSP 提到"
        }, {
            "id": 5536189,
            "user_id": 296528,
            "type": "friend",
            "unread": true,
            "author_id": 287813,
            "author": "Range6",
            "html_message": "\u003ca href=\"home.php?mod=space\u0026uid=287813\"\u003eRange6\u003c/a\u003e 请求加您为好友，附言：msg\u0026nbsp;\u0026nbsp;\u003ca onclick=\"showWindow(this.id, this.href, 'get', 0);\" class=\"xw1\" id=\"afr_287813\" href=\"home.php?mod=spacecp\u0026ac=friend\u0026op=add\u0026uid=287813\u0026from=notice\"\u003e批准申请\u003c/a\u003e",
            "dateline": 1765419206,
            "from_id": 287813,
            "from_id_type": "friendrequest",
            "from_num": 1,
            "category": 2,
            "friend_note": "msg"
        }],
        "new_chats": [{
            "last_author_id": 305346,
            "last_author": "0x444858",
            "last_summary": "私信",
            "to_uid": 305346,
            "to_username": "0x444858",
            "conversation_id": 4162272,
            "unread": true,
            "message_count": 3,
            "last_update": 0,
            "last_dateline": 1765420812,
            "author_id": 305346,
            "type": "personal",
            "subject": "test3",
            "member_count": 0,
            "create_time": 1764241003
        }, {
            "last_author_id": 287813,
            "last_author": "Range6",
            "last_summary": "私信",
            "to_uid": 287813,
            "to_username": "Range6",
            "conversation_id": 4136458,
            "unread": true,
            "message_count": 19,
            "last_update": 1764414392,
            "last_dateline": 1765419521,
            "author_id": 287813,
            "type": "personal",
            "subject": "关于您在“测试”的帖子\ntest",
            "member_count": 0,
            "create_time": 1736608440
        }]
    },
    "user": {
        "uid": 296528,
        "username": "AOSP",
        "new_pm_legacy": true,
        "new_notification": 7,
        "new_pm": 0,
        "new_grouppm_legacy": false,
        "settings_version": 0
    },
    "system": {
        "settings_version": 11,
        "client_version": 1
    }
}
```

## 将指定消息标记为已读

```text
GET /_/messages/notifications/read/5536274?kind=reply HTTP/1.1
Host: bbs.uestc.edu.cn
Cookie: 有效Cookie
Authorization: 有效Authorization
```

</details>
<br>

方法：`GET`

可变路径：`/_/messages/notifications/read/{id}`

参数：

- `kind`: 提醒类型

说明：`id`和`kind`的值均来自[获取新消息提醒摘要](#获取新消息提醒摘要)的返回数据。

### 响应

```json
{
    "code": 0,
    "message": "success",
    "data": null,
    "user": {
        "uid": 296528,
        "username": "AOSP",
        "new_pm_legacy": true,
        "new_notification": 7,
        "new_pm": 0,
        "new_grouppm_legacy": false,
        "settings_version": 0
    },
    "system": {
        "settings_version": 11,
        "client_version": 1
    }
}
```

注意：`new_chats`里面的私信提醒不用调用本接口，在`Discuz!`系统中已读就行。
