# 帖子详情

要使用此文档所示的接口，请先[登录](./登录.md)。

## 获取帖子回复

<details>
    <summary>数据包</summary>

```text
GET /_/post/list?thread_id=2345624&page=1 HTTP/1.1
Host: bbs.uestc.edu.cn
Cookie: 有效Cookie
Authorization: 有效Authorization
```

</details>
<br>

方法：`GET`

路径：`/_/post/list`

参数：

- `thread_id`: 帖子tid
- `page`: 页码

### 响应

由于响应的json长度较大，此处只展示一部分用于说明数据结构。

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "total": 23,
        "page_size": 20,
        "page": 1,
        "rows": [{
            "post_id": 40479569,
            "forum_id": 1024,
            "thread_id": 2345624,
            "position": 1,
            "is_first": 1,
            "subject": "测试帖",
            "support": 0,
            "oppose": 0,
            "message": "主题帖正文",
            "dateline": 1752839845,
            "format": -1,
            "usesig": 1,
            "smileyoff": -1,
            "parseurloff": 0,
            "status": 0,
            "has_comment": true,
            "author": "Range6",
            "author_id": 287813,
            "author_details": {
                "group_id": 26,
                "level_id": 10,
                "group_title": "海豚 (Lv.10)",
                "group_subtitle": "",
                "group_icon": "data/attachment/common/b6/common_22_usergroup_icon.gif",
                "ext_credits": {
                    "威望": 7,
                    "水滴": 9839
                },
                "posts": 15651,
                "digests": 0,
                "medals": [141, 144, 153, 54, 112, 133, 137, 151, 154, 156, 157],
                "signature": "",
                "signature_format": "html",
                "custom_title": "",
                "online_time": 7409,
                "last_visit": 1765373626,
                "credits": 9009,
                "register_time": 1723621452
            },
            "reply_credit_amount": 5,
            "reply_credit_name": "水滴"
        }, {
            "post_id": 40479574,
            "forum_id": 1024,
            "thread_id": 2345624,
            "position": 2,
            "subject": "",
            "support": 0,
            "oppose": 0,
            "message": "回复楼层",
            "dateline": 1752839871,
            "format": -1,
            "usesig": 1,
            "smileyoff": -1,
            "parseurloff": 0,
            "status": 1024,
            "has_comment": true,
            "has_rate": true,
            "lastedit_id":46520,
            "author": "Range6",
            "author_id": 287813,
            "author_details": {
                "group_id": 26,
                "level_id": 10,
                "group_title": "海豚 (Lv.10)",
                "group_subtitle": "",
                "group_icon": "data/attachment/common/b6/common_22_usergroup_icon.gif",
                "ext_credits": {
                    "威望": 7,
                    "水滴": 9839
                },
                "posts": 15651,
                "digests": 0,
                "medals": [141, 144, 153, 54, 112, 133, 137, 151, 154, 156, 157],
                "signature": "",
                "signature_format": "html",
                "custom_title": "",
                "online_time": 7409,
                "last_visit": 1765373626,
                "credits": 9009,
                "register_time": 1723621452
            },
            "last_edit_time":1765388127,
            "last_editor":"Range6",
            "last_editor_uid":287813
        }]
    },
    "user": {
        "uid": 287813,
        "username": "Range6",
        "new_pm_legacy": false,
        "new_notification": 0,
        "new_pm": 0,
        "new_grouppm_legacy": false,
        "settings_version": 0
    },
    "system": {
        "settings_version": 11,
        "client_version": 1
    }
}
```

`rows`字段为回复列表。`reply_credit_amount`和`reply_credit_name`只在散水贴的中奖回复出现。

## 在获取回复时获取其余信息

<details>
    <summary>数据包</summary>

```text
GET /_/post/list?thread_id=2345624&page=1&thread_details=1&forum_details=1 HTTP/1.1
Host: bbs.uestc.edu.cn
Cookie: 有效Cookie
Authorization: 有效Authorization
```

</details>
<br>

方法：`GET`

路径：`/_/post/list`

参数：

- `thread_id`: 帖子tid
- `page`: 页码
- `thread_details`: 是否获取帖子详情
- `forum_details`: 是否获取帖子所在版块详情

### 响应

由于响应的json长度较大，此处只展示一部分用于说明数据结构。

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "total": 23,
        "page_size": 20,
        "page": 1,
        "thread": {
            "thread_id": 2345624,
            "forum_id": 1024,
            "type_id": 1437,
            "author": "Range6",
            "author_id": 287813,
            "subject": "测试帖",
            "dateline": 1752839845,
            "last_post": 1752843255,
            "last_poster": "Range6",
            "views": 41,
            "replies": 22,
            "display_order": 0,
            "is_rated": 0,
            "special": 0,
            "attachment": 0,
            "is_moderated": 1,
            "has_stick_reply": 0,
            "is_closed": 0,
            "recommends": 0,
            "recommend_add": 0,
            "recommend_sub": 0,
            "heats": 1,
            "status": 32,
            "favorite_times": 0,
            "share_times": 0,
            "stamp": -1,
            "icon": -1,
            "cover": 0,
            "max_position": 23,
            "comments": 2,
            "can_reply": true,
            "last_moderation": {
                "uid": 98740,
                "username": "____",
                "dateline": 1752840048,
                "action": "移动"
            },
            "rush_reply": {
                "max_position": 1000000,
                "start_time": 1735660800,
                "end_time": 1767196800,
                "target_positions": ["*25", "*025", "*0025", "*0000"],
                "max_consecutive_replies": 9,
                "awards": [{
                    "position_match": "*25",
                    "ext_credits": {
                        "2": 20
                    }
                }, {
                    "position_match": "*025",
                    "ext_credits": {
                        "2": 30
                    }
                }, {
                    "position_match": "*0025",
                    "ext_credits": {
                        "2": 50
                    }
                }, {
                    "position_match": "*0000",
                    "ext_credits": {
                        "1": 1,
                        "2": 100
                    }
                }],
                "ext_credits_award_max": {
                    "2": 2000
                }
            }, 
            "collections": [{
                "collection_id": 926,
                "uid": 265617,
                "username": "鲲山煜碎",
                "name": "码住",
                "dateline": 1743924684,
                "follows": 15,
                "threads": 100,
                "comments": 1,
                "description": "",
                "last_update": 1764833339,
                "average_rate": 5,
                "rates": 1,
                "latest_thread": {
                    "thread_id": 2334875,
                    "subject": "万里探店小记合集（定期更新）",
                    "dateline": 1751100193,
                    "lastpost_author": "万里暮云平"
                },
                "last_visit": 1764472406,
                "keyword": ""
            }],
            "reply_credit": {
                "credit_amount": 5,
                "count": 10,
                "limit_per_user": 2,
                "probability": 70,
                "credit_name": "水滴",
                "remaining_amount": 50
            },
            "poll": {
                "show_voters": true,
                "multiple": true,
                "visible": false,
                "max_choices": 2,
                "is_image": false,
                "expiration": 1765560085,
                "voter_count": 0,
                "options": [{
                    "id": 149925,
                    "display_order": 0,
                    "text": "option 1"
                }, {
                    "id": 149926,
                    "display_order": 0,
                    "text": "option 2"
                }, {
                    "id": 149927,
                    "display_order": 0,
                    "text": "option 3"
                }]
            }
        },
        "forum": {
            "fid": 1024,
            "name": "开发者专区",
            "can_post_thread": true,
            "can_post_reply": true,
            "can_post_anonymously": false,
            "threads": 29,
            "posts": 289,
            "todayposts": 3,
            "yesterdayposts": 6,
            "latest_thread": null,
            "moderators": [],
            "parents": [{
                "fid": 138,
                "name": "清水议会",
                "hidden_home": false,
                "threads": 0,
                "posts": 0,
                "todayposts": 0,
                "yesterdayposts": 0,
                "latest_thread": null,
                "moderators": null,
                "children": null
            }, {
                "fid": 1,
                "name": "站务管理",
                "hidden_home": false,
                "threads": 0,
                "posts": 0,
                "todayposts": 0,
                "yesterdayposts": 0,
                "latest_thread": null,
                "moderators": null,
                "children": null
            }],
            "thread_types": [{
                "type_id": 1437,
                "name": "TEST"
            }, {
                "type_id": 1442,
                "name": "BUG"
            }, {
                "type_id": 1439,
                "name": "求助"
            }, {
                "type_id": 1440,
                "name": "讨论"
            }, {
                "type_id": 1441,
                "name": "感想"
            }, {
                "type_id": 1438,
                "name": "公告",
                "moderators_only": true
            }],
            "optional_thread_type": false,
            "announcement": "",
            "announcement_format": "html",
            "post_notice": {
                "newthread": "[size=3][b][color=red]【温馨提示】请勿重复发帖、一帖发多区。[/color][/b][/size]",
                "newthread_mobile": "",
                "newthread_quick": "",
                "reply": "[size=3][b][color=red]除水手之家外其他版块禁止回复灌水无意义内容或纯表情。请注意时间，不要挖坟。[/color][/b][/size]",
                "reply_mobile": "",
                "reply_quick": "",
                "reply_quick_mobile": "",
                "editthread": "",
                "editthread_mobile": "",
                "poll": ""
            },
            "post_notice_format": "bbcode",
            "live_thread_id": 0
        },
        "rows": [{
            "post_id": 40479569,
            "forum_id": 1024,
            "thread_id": 2345624,
            "position": 1,
            "is_first": 1,
            "subject": "测试帖",
            "support": 0,
            "oppose": 0,
            "message": "主题帖正文",
            "dateline": 1752839845,
            "format": -1,
            "usesig": 1,
            "smileyoff": -1,
            "parseurloff": 0,
            "status": 0,
            "has_comment": true,
            "author": "Range6",
            "author_id": 287813,
            "author_details": {
                "group_id": 26,
                "level_id": 10,
                "group_title": "海豚 (Lv.10)",
                "group_subtitle": "",
                "group_icon": "data/attachment/common/b6/common_22_usergroup_icon.gif",
                "ext_credits": {
                    "威望": 7,
                    "水滴": 9839
                },
                "posts": 15651,
                "digests": 0,
                "medals": [141, 144, 153, 54, 112, 133, 137, 151, 154, 156, 157],
                "signature": "",
                "signature_format": "html",
                "custom_title": "",
                "online_time": 7409,
                "last_visit": 1765373989,
                "credits": 9009,
                "register_time": 1723621452
            }
        }, {
            "post_id": 40479574,
            "forum_id": 1024,
            "thread_id": 2345624,
            "position": 2,
            "subject": "",
            "support": 0,
            "oppose": 0,
            "message": "回复楼层",
            "dateline": 1752839871,
            "format": -1,
            "usesig": 1,
            "smileyoff": -1,
            "parseurloff": 0,
            "status": 1024,
            "has_comment": true,
            "author": "Range6",
            "author_id": 287813,
            "author_details": {
                "group_id": 26,
                "level_id": 10,
                "group_title": "海豚 (Lv.10)",
                "group_subtitle": "",
                "group_icon": "data/attachment/common/b6/common_22_usergroup_icon.gif",
                "ext_credits": {
                    "威望": 7,
                    "水滴": 9839
                },
                "posts": 15651,
                "digests": 0,
                "medals": [141, 144, 153, 54, 112, 133, 137, 151, 154, 156, 157],
                "signature": "",
                "signature_format": "html",
                "custom_title": "",
                "online_time": 7409,
                "last_visit": 1765373989,
                "credits": 9009,
                "register_time": 1723621452
            }
        }]
    },
    "user": {
        "uid": 287813,
        "username": "Range6",
        "new_pm_legacy": false,
        "new_notification": 0,
        "new_pm": 0,
        "new_grouppm_legacy": false,
        "settings_version": 0
    },
    "system": {
        "settings_version": 11,
        "client_version": 1
    }
}
```

说明：`thread`中的`rush_reply`为抢楼帖特有，`collections`只有被淘专辑收录的帖子才，`reply_credit`散水贴才有，`pool`投票帖才有。

## 获取点评

<details>
    <summary>数据包</summary>

```text
GET /_/post/details?thread_id=2345624&comment_pids=40479569,40479574 HTTP/1.1
Host: bbs.uestc.edu.cn
Cookie: 有效Cookie
Authorization: 有效Authorization
```

</details>
<br>

方法：`GET`

路径：`/_/post/details`

参数：

- `thread_id`: 帖子tid
- `comment_pids`: 要获取点评的帖子pid，用`,`隔开

### 响应

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "40479569": {
            "comments": [{
                "id": 306591,
                "author": "Range6",
                "author_id": 287813,
                "dateline": 1752839864,
                "message": "对主题帖进行点评"
            }],
            "comment_total": 1,
            "comment_pages": 1,
            "comment_page_size": 10
        },
        "40479574": {
            "comments": [{
                "id": 306592,
                "author": "Range6",
                "author_id": 287813,
                "dateline": 1752839880,
                "message": "对回复进行点评"
            }],
            "comment_total": 1,
            "comment_pages": 1,
            "comment_page_size": 10
        }
    },
    "user": {
        "uid": 287813,
        "username": "Range6",
        "new_pm_legacy": false,
        "new_notification": 0,
        "new_pm": 0,
        "new_grouppm_legacy": false,
        "settings_version": 0
    },
    "system": {
        "settings_version": 11,
        "client_version": 1
    }
}
```

## 获取评分

<details>
    <summary>数据包</summary>

```text
GET /_/post/details?thread_id=2412873&rate_pids=41374524 HTTP/1.1
Host: bbs.uestc.edu.cn
Cookie: 有效Cookie
Authorization: 有效Authorization
```

</details>
<br>

方法：`GET`

路径：`/_/post/details`

参数：

- `thread_id`: 帖子tid
- `rate_pids`: 要获取评分的帖子pid，用`,`隔开

### 响应

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "41374524": {
            "rates": [{
                "user_id": 305346,
                "username": "0x444858",
                "credits": {
                    "水滴": 1
                },
                "dateline": 1765374593,
                "reason": "test"
            }],
            "rate_stat": {
                "total_users": 1,
                "total_credits": {
                    "水滴": 1
                }
            }
        }
    },
    "user": {
        "uid": 287813,
        "username": "Range6",
        "new_pm_legacy": false,
        "new_notification": 0,
        "new_pm": 0,
        "new_grouppm_legacy": false,
        "settings_version": 0
    },
    "system": {
        "settings_version": 11,
        "client_version": 1
    }
}
```

此时你可能已经注意到了，上面两个接口的地址一样，只是参数不同，因此你实际上可以[同时获得点评和评分](#同时获得点评和评分)。

## 同时获得点评和评分

<details>
    <summary>数据包</summary>

```text
GET /_/post/details?thread_id=2412873&rate_pids=41374524&comment_pids=41374524 HTTP/1.1
Host: bbs.uestc.edu.cn
Cookie: 有效Cookie
Authorization: 有效Authorization
```

</details>
<br>

方法：`GET`

路径：`/_/post/details`

参数：

- `thread_id`: 帖子tid
- `rate_pids`: 要获取评分的帖子pid，用`,`隔开
- `comment_pids`: 要获取点评的帖子pid，用`,`隔开

### 响应

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "41374524": {
            "comments": [{
                "id": 309440,
                "author": "0x444858",
                "author_id": 305346,
                "dateline": 1765375339,
                "message": "cmt"
            }],
            "comment_total": 1,
            "comment_pages": 1,
            "comment_page_size": 10,
            "rates": [{
                "user_id": 305346,
                "username": "0x444858",
                "credits": {
                    "水滴": 1
                },
                "dateline": 1765374593,
                "reason": "test"
            }],
            "rate_stat": {
                "total_users": 1,
                "total_credits": {
                    "水滴": 1
                }
            }
        }
    },
    "user": {
        "uid": 287813,
        "username": "Range6",
        "new_pm_legacy": false,
        "new_notification": 1,
        "new_pm": 0,
        "new_grouppm_legacy": false,
        "settings_version": 0
    },
    "system": {
        "settings_version": 11,
        "client_version": 1
    }
}
```

## 根据pid定位帖子

<details>
    <summary>数据包</summary>

```text
GET /_/post/find?pid=38913954 HTTP/1.1
Host: bbs.uestc.edu.cn
Cookie: 有效Cookie
Authorization: 有效Authorization
```

</details>
<br>

方法：`GET`

路径：`/_/post/find`

参数：

- `pid`: 帖子pid

### 响应

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "position": 181,
        "thread_id": 2234791
    },
    "user": {
        "uid": 287813,
        "username": "Range6",
        "new_pm_legacy": false,
        "new_notification": 0,
        "new_pm": 0,
        "new_grouppm_legacy": false,
        "settings_version": 0
    },
    "system": {
        "settings_version": 11,
        "client_version": 1
    }
}
```

`position`为目标所在楼层，计算出页数后，通过[获取帖子回复](#获取帖子回复)时指定页码即可获得目标所在页。
